---
import ToggleTheme from '@/components/ToggleTheme'
import BaseLayout from './BaseLayout.astro'
import config from '../config'

let avatar = 'https://chetxu.chetserenade.info/article/avatar.jpg'
---

<BaseLayout title={Astro.props.title ? `${Astro.props.title} | ${config.title}` : config.title}>
  <div>
    <div class="lg:flex home">
      <div id="pc-container" class="sm:px-10 lg:mt-10 py-20 desktop nav-view">
        <div class="sticky top-5 flex flex-col gap-4">
          <div class="w-32 h-32 bg-cover bg-center inline-block mx-auto">
            <img src={avatar} alt="头像" />
          </div>
          <div class="mediate">
            <h1 class="font-bold text-2xl">{config.name}</h1>
            <div class="text-gray-600 text-base font-light my-2">
              <div class="flex">
                <div id="theme">
                  <ToggleTheme />
                </div>
                <span class="ml-6 mt-1">{config.signature}</span>
              </div>
            </div>
          </div>

          <div class="flex lg:flex-col gap-4 mt-4 mx-auto nav-webfont">
            {
              config.navs.map((nav) => {
                const { pathname } = Astro.url
                const trimmedPathname = pathname === '/' ? pathname : pathname.replace(/\/$/, '')
                const isActive = trimmedPathname === nav.url
                return (
                  <a
                    href={nav.url}
                    class:list={isActive ? 'active' : ''}
                    rel={nav.url.startsWith('http') ? 'noopener' : undefined}
                  >
                    {nav.title}
                  </a>
                )
              })
            }
          </div>
          <div class="text-slate-500 text-sm mediate">
            Blog since {config.since}
          </div>
        </div>
      </div>

      <div id="mobile-container" class="sm:px-10 lg:mt-10 py-20 mobile mobile-menu opened">
        <div class="sticky top-5 flex flex-col gap-4">
          <div class="mediate">
            <div class="w-32 h-32 bg-cover bg-center inline-block mx-auto">
              <img src={avatar} alt="头像" />
            </div>
            <h1 class="font-bold text-2xl font-name">{config.name}</h1>
            <div class="text-gray-600 text-base font-light my-2">
              <div class="flex">
                <div id="theme">
                  <ToggleTheme />
                </div>
                <span class="ml-6 mt-1" style="margin-left:24px">{config.signature}</span>
              </div>
            </div>
          </div>
          <div class="flex lg:flex-col gap-4 mt-4 mx-auto nav-webfont">
            {
              config.navs.map((nav) => {
                const { pathname } = Astro.url
                const trimmedPathname = pathname === '/' ? pathname : pathname.replace(/\/$/, '')
                const isActive = trimmedPathname === nav.url
                return (
                  <a
                    href={nav.url}
                    class:list={isActive ? 'active' : ''}
                    rel={nav.url.startsWith('http') ? 'noopener' : undefined}
                  >
                    {nav.title}
                  </a>
                )
              })
            }
          </div>
          <div class="text-slate-500 text-sm mediate">
            Blog since {config.since}
          </div>
        </div>
      </div>

      <div class="toggle bg-frostedGlass dark:bg-markerShadow mobile header-navbar">
        <div class="toggle-menu" id="toggle"><i class="iconfont icon-menu"></i></div>
        <div class="header-slogan">Jed's log</div>
      </div>
      <div class="lg:mt-28 mx-4 lg:mx-0 ml-52 md w-full container-main opened">
        <div class="container">
          <slot />
        </div>
      </div>

      <div class="desktop">
        <slot name="catalogue" />
      </div>
    </div>
  </div>
</BaseLayout>

<script>
  const toggleButton = document.getElementById('toggle')
  const mobileMenuSelector = '.mobile-menu'
  const containerMainSelector = '.container-main'
  const headerNavbarSelector = '.header-navbar'

  if (toggleButton) {
    toggleButton.addEventListener('click', () => {
      const mobileMenu = document.querySelector(mobileMenuSelector)
      const containerMain = document.querySelector(containerMainSelector)
      const headerNavbar = document.querySelector(headerNavbarSelector)

      // 使用可选链操作符确保元素不为 null
      mobileMenu?.classList.toggle('opened-pc')
      containerMain?.classList.toggle('opened-mobile')
      headerNavbar?.classList.toggle('opened-mobile')
    })
  }

  function toggleView() {
    const pcContainer = document.getElementById('pc-container')
    const mobileContainer = document.getElementById('mobile-container')

    if (pcContainer && mobileContainer) {
      if (window.innerWidth > 1010) {
        pcContainer.style.display = 'block'
        mobileContainer.style.display = 'none'
        mobileContainer.innerHTML = ''
      } else {
        pcContainer.style.display = 'none'
        mobileContainer.style.display = 'block'
        pcContainer.innerHTML = ''
      }
    }
  }

  window.addEventListener('resize', toggleView)
  toggleView()
</script>
